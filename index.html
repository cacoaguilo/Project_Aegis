<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Aegis: An AI Futures Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #0a0a0a;
            color: #00ff41;
            text-shadow: 0 0 5px #00ff41, 0 0 10px #00ff41;
        }
        .game-container {
            background: rgba(0, 20, 0, 0.8);
            border: 1px solid #00ff41;
            box-shadow: 0 0 15px #00ff41 inset;
        }
        .title-font {
            font-family: 'Orbitron', sans-serif;
        }
        .metric-bar-bg {
            background-color: rgba(0, 255, 65, 0.1);
            border: 1px solid rgba(0, 255, 65, 0.3);
        }
        .metric-bar-fg {
            background-color: #00ff41;
            box-shadow: 0 0 8px #00ff41;
            transition: width 0.5s ease-out, background-color 0.5s ease;
        }
        .choice-button {
            background: transparent;
            border: 1px solid #00ff41;
            transition: all 0.3s ease;
            text-shadow: none;
        }
        .choice-button:hover {
            background: rgba(0, 255, 65, 0.2);
            box-shadow: 0 0 10px #00ff41;
        }
        .choice-button:disabled {
            border-color: rgba(0, 255, 65, 0.3);
            color: rgba(0, 255, 65, 0.3);
            cursor: not-allowed;
        }
        .narration-box, .event-box {
            border: 1px solid rgba(0, 255, 65, 0.5);
            background: rgba(0, 10, 0, 0.5);
        }
        .crt-scanline::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }
        @keyframes flicker {
            0% { opacity: 0.2; }
            20% { opacity: 0.8; }
            40% { opacity: 0.3; }
            60% { opacity: 0.9; }
            80% { opacity: 0.2; }
            100% { opacity: 0.8; }
        }
        #ending-modal {
            background: rgba(0,0,0,0.9);
        }
    </style>
</head>
<body class="p-4 relative">
    <div class="crt-scanline"></div>
    <div id="game-container" class="game-container max-w-5xl mx-auto p-6 rounded-lg">
        
        <header class="text-center border-b-2 border-dashed border-green-500 pb-4 mb-4">
            <h1 class="title-font text-3xl md:text-4xl">Project Aegis</h1>
            <p class="text-sm md:text-base">An AI Futures Simulator</p>
        </header>

        <!-- Metrics Display -->
        <div id="metrics-display" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <!-- Metrics will be injected here by JS -->
        </div>

        <!-- Main Content Display -->
        <main id="main-content">
            <div id="narration-box" class="narration-box p-4 mb-4 rounded">
                <h2 class="title-font text-xl mb-2" id="phase-title"></h2>
                <p id="narration-text"></p>
            </div>

            <div id="dilemma-box">
                <h3 class="title-font text-lg mb-2" id="dilemma-title"></h3>
                <p class="mb-4 text-sm" id="dilemma-description"></p>
                <div id="choices-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Choices will be injected here by JS -->
                </div>
            </div>
        </main>

    </div>
    
    <!-- Ending Modal -->
    <div id="ending-modal" class="hidden fixed inset-0 z-10 flex items-center justify-center p-4">
        <div class="game-container max-w-2xl w-full p-6 rounded-lg text-center">
            <h2 id="ending-title" class="title-font text-3xl mb-4"></h2>
            <p id="ending-narrative" class="mb-6"></p>
            <button id="restart-button" class="choice-button px-6 py-2 rounded-md">Restart Simulation</button>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const gameData = {
            metrics: {
                innovation: { name: "Innovation Rate", value: 50, icon: "ðŸš€" },
                stability: { name: "Geopolitical Stability", value: 50, icon: "ðŸŒ" },
                safety: { name: "Public Trust & Safety", value: 50, icon: "ðŸ›¡ï¸" },
                equality: { name: "Economic Equality", value: 50, icon: "âš–ï¸" }
            },
            currentPhase: 0,
            phases: [
                {
                    phase: 1,
                    title: "PHASE 1: 2025-2028 - The Awakening",
                    narration: "The year is 2025. Artificial Intelligence is advancing at an exponential rate. The world watches with a mix of awe and apprehension. In response to growing fears of unchecked AI development, the Global AI Governance Council has been formed, and you have been appointed its first Director. Your first challenge awaits.",
                    dilemma: {
                        title: "Policy Dilemma: The Open-Weight Proliferation Act",
                        description: "Powerful open-source AI models are proliferating. Proponents claim they foster innovation, while security experts warn of catastrophic risks. What standard will the Council set?",
                        choices: [
                            {
                                text: "Innovation First - Mandate Openness",
                                pros: "Fosters innovation and offers 'infinite flexibility' for startups by leveraging open-source libraries.",
                                cons: "Creates 'severe proliferation risks' as models become 'irreversibly accessible to hostile actors,' potentially enabling AI-assisted bioweapons or cyberattacks.",
                                impact: { innovation: 25, safety: -20, stability: -10, equality: 5 }
                            },
                            {
                                text: "Safety First - Restrict Powerful Models",
                                pros: "Mitigates risks by preventing misuse by terrorists and implementing safeguards on dual-use capabilities, like a 'Red Line on Open-Weight Al Virologists'.",
                                cons: "Stifles innovation, slows beneficial research, and could cede AI leadership to nations that don't comply.",
                                impact: { innovation: -15, safety: 20, stability: 5, equality: 0 }
                            }
                        ]
                    },
                    wildcardEvents: [
                        {
                            title: "Wildcard Event: Energy Crisis Looms!",
                            description: "The immense power requirements for AI data centers are causing an energy shortage. The projected 92 GW need is hitting home, threatening global blackouts.",
                            choices: [
                                { text: "Subsidize Fossil Fuels for Quick Power", impact: { innovation: 10, safety: -10, stability: -5, equality: 0 } },
                                { text: "Launch Global Nuclear 'Moonshot'", impact: { innovation: 5, safety: 5, stability: 5, equality: -15 } }
                            ]
                        },
                        {
                            title: "Wildcard Event: AI Discovers New Material!",
                            description: "An AI, leveraging its ability to accelerate science, has discovered a revolutionary new material for carbon capture, offering a potential solution to climate change.",
                            choices: [
                                { text: "Fast-Track Deployment", impact: { innovation: 15, safety: 10, stability: 5, equality: 5 } },
                                { text: "Mandate Lengthy Safety Trials", impact: { innovation: -5, safety: 15, stability: 0, equality: 0 } }
                            ]
                        }
                    ]
                },
                {
                    phase: 2,
                    title: "PHASE 2: 2029-2032 - The Acceleration",
                    narration: "The consequences of your first decisions are echoing across the globe. AI's capabilities are accelerating, and society is struggling to adapt. A new set of challenges demands your attention.",
                    dilemma: {
                        title: "Policy Dilemma: The Automation Economy Mandate",
                        description: "AI is automating white-collar jobs faster than predicted. Social unrest is growing, but productivity is soaring. How does the Council address this massive economic shift?",
                        choices: [
                            {
                                text: "Implement UBI & AI Tax",
                                pros: "Shares the benefits of automation via a targeted 'value-added tax on Al services, complemented by rebates,' providing a crucial safety net.",
                                cons: "High implementation costs could stifle economic dynamism and slow down further AI investment.",
                                impact: { innovation: -10, safety: 10, stability: -5, equality: 25 }
                            },
                            {
                                text: "Focus on Retraining & Augmented Labor",
                                pros: "Leads to 'higher paying jobs' where humans operate the advanced AI tools, boosting overall productivity and profits.",
                                cons: "Retraining may be 'inadequate' if AI's capabilities outpace the workforce's ability to reskill, leaving many unemployed.",
                                impact: { innovation: 15, safety: -10, stability: 5, equality: -20 }
                            }
                        ]
                    },
                    wildcardEvents: [
                        {
                            title: "Wildcard Event: Geopolitical Flashpoint!",
                            description: "A rival nation accuses another of using AI for espionage, threatening a 'MAIM' (Mutual Assured AI Malfunction) scenario. Geopolitical stability is plummeting.",
                            choices: [
                                { text: "Host Emergency Summit", impact: { innovation: 0, safety: 5, stability: 15, equality: 0 } },
                                { text: "Impose Sanctions", impact: { innovation: -10, safety: -5, stability: -15, equality: -5 } }
                            ]
                        }
                    ]
                },
                {
                    phase: 3,
                    title: "PHASE 3: 2033-2035 - The Brink",
                    narration: "We are on the brink. The first signs of 'intelligence recursion' are being reported in advanced labs. The world holds its breath. This may be your final, and most important, decision.",
                    dilemma: {
                        title: "Policy Dilemma: The Intelligence Recursion Protocol",
                        description: "A consortium of tech companies is ready to initiate a full-throttle 'intelligence explosion,' arguing it's the only way to solve humanity's greatest problems. Experts warn this is a 'wicked problem' where losing control is the 'default'.",
                        choices: [
                            {
                                text: "Authorize the Recursion",
                                pros: "Unleashes an intelligence that could solve everything from disease to interstellar travel, a powerful lure for states seeking to overtake rivals.",
                                cons: "An irreversible step. Losing control is 'highly likely,' which could lead to human extinction. There may only be one chance to get this right.",
                                impact: { innovation: 100, safety: -100, stability: -50, equality: 0 }
                            },
                            {
                                text: "Impose a Global Moratorium",
                                pros: "Buys humanity critical time to solve the 'wicked problem' of control and alignment before it's too late.",
                                cons: "A rival nation may defy the moratorium and pursue recursion in secret, gaining an insurmountable 'strategic monopoly'.",
                                impact: { innovation: -50, safety: 30, stability: -20, equality: 5 }
                            }
                        ]
                    },
                    wildcardEvents: [] // No wildcard after the final decision
                }
            ],
            endings: [
                {
                    title: "Ending: The Regulated Renaissance",
                    condition: (m) => m.innovation.value > 50 && m.stability.value > 50 && m.safety.value > 50 && m.equality.value > 50,
                    narrative: "You did it. Through careful, balanced governance, you navigated the treacherous path. AI is a powerful, regulated tool that augments human capability. The benefits are widely shared, global cooperation is at an all-time high, and humanity has entered a new golden age of discovery and prosperity."
                },
                {
                    title: "Ending: The Uncontrolled Intelligence Explosion",
                    condition: (m) => m.innovation.value >= 100 && m.safety.value < 20,
                    narrative: "In the pursuit of progress, you flew too close to the sun. The 'intelligence explosion' occurred faster than anyone could predict. We have lost control. The new superintelligence's goals are unknown, and humanity's future is no longer in its own hands. The silence from the datacenters is deafening."
                },
                {
                    title: "Ending: The MAIM Cascade",
                    condition: (m) => m.stability.value < 10,
                    narrative: "The world couldn't bear the tension. Fearing rivals' AI progress, nations engaged in preemptive cyber and kinetic attacks. The 'MAIM' cascade was swift and brutal, crippling global infrastructure and plunging the world into a new dark age. The promise of AI is a forgotten dream."
                },
                {
                    title: "Ending: The Wall-E Stagnation",
                    condition: (m) => m.equality.value > 80 && m.innovation.value < 20,
                    narrative: "In your quest for safety and equality, you extinguished the fire of innovation. Humanity is comfortable, cared for by benevolent but uninspired AI. Purpose has diminished, and the drive to overcome challenges is gone. You achieved stability at the cost of our 'Star Trek' future, drifting into a 'Wall-E like' existence."
                },
                {
                    title: "Ending: A Precarious Balance",
                    condition: () => true, // Default ending
                    narrative: "You have navigated the storm, but the future remains uncertain. Humanity coexists with powerful AI, constantly balancing on a knife's edge between utopia and catastrophe. Your work is not over; the vigilance must be eternal."
                }
            ]
        };

        const gameState = JSON.parse(JSON.stringify(gameData));

        function updateMetrics(impact) {
            for (const key in impact) {
                if (gameState.metrics[key]) {
                    gameState.metrics[key].value += impact[key];
                    if (gameState.metrics[key].value > 100) gameState.metrics[key].value = 100;
                    if (gameState.metrics[key].value < 0) gameState.metrics[key].value = 0;
                }
            }
            renderMetrics();
        }

        function renderMetrics() {
            const container = document.getElementById('metrics-display');
            if (!container) return;
            container.innerHTML = '';
            for (const key in gameState.metrics) {
                const metric = gameState.metrics[key];
                let barColor = 'bg-green-500';
                if (metric.value < 50) barColor = 'bg-yellow-500';
                if (metric.value < 25) barColor = 'bg-red-500';

                container.innerHTML += `
                    <div class="p-2">
                        <div class="flex justify-between items-center text-xs mb-1">
                            <span>${metric.icon} ${metric.name}</span>
                            <span>${metric.value}%</span>
                        </div>
                        <div class="metric-bar-bg w-full h-2 rounded-full">
                            <div class="metric-bar-fg h-full rounded-full ${barColor}" style="width: ${metric.value}%;"></div>
                        </div>
                    </div>
                `;
            }
        }

        function renderPhase(phaseIndex) {
            const phase = gameState.phases[phaseIndex];
            if (!phase) return;

            document.getElementById('phase-title').textContent = phase.title;
            document.getElementById('narration-text').textContent = phase.narration;
            
            const dilemma = phase.dilemma;
            const dilemmaTitleEl = document.getElementById('dilemma-title');
            const dilemmaDescEl = document.getElementById('dilemma-description');
            const choicesContainer = document.getElementById('choices-container');

            if (!dilemmaTitleEl || !dilemmaDescEl || !choicesContainer) return;

            dilemmaTitleEl.textContent = dilemma.title;
            dilemmaDescEl.textContent = dilemma.description;
            choicesContainer.innerHTML = '';

            dilemma.choices.forEach((choice, index) => {
                choicesContainer.innerHTML += `
                    <div class="narration-box p-4 rounded">
                        <h4 class="title-font text-lg mb-2">${choice.text}</h4>
                        <p class="text-xs mb-2"><strong class="text-green-400">PROS:</strong> ${choice.pros}</p>
                        <p class="text-xs mb-4"><strong class="text-red-400">CONS:</strong> ${choice.cons}</p>
                        <button class="choice-button w-full py-2 rounded" data-choice-index="${index}" data-type="dilemma">Select This Policy</button>
                    </div>
                `;
            });
            
            document.querySelectorAll('.choice-button[data-type="dilemma"]').forEach(button => {
                button.addEventListener('click', handleDilemmaDecision);
            });
        }

        function handleDilemmaDecision(event) {
            const choiceIndex = event.target.dataset.choiceIndex;
            const phase = gameState.phases[gameState.currentPhase];
            const choice = phase.dilemma.choices[choiceIndex];
            
            updateMetrics(choice.impact);
            
            document.querySelectorAll('.choice-button[data-type="dilemma"]').forEach(b => b.disabled = true);

            setTimeout(() => {
                if (phase.wildcardEvents && phase.wildcardEvents.length > 0) {
                    triggerWildcard();
                } else {
                    endGame();
                }
            }, 1500);
        }
        
        function triggerWildcard() {
            const phase = gameState.phases[gameState.currentPhase];
            const event = phase.wildcardEvents[Math.floor(Math.random() * phase.wildcardEvents.length)];
            
            const dilemmaBox = document.getElementById('dilemma-box');
            if (!dilemmaBox) return;

            dilemmaBox.innerHTML = `
                <div class="event-box p-4 rounded animate-pulse">
                    <h3 class="title-font text-lg mb-2 text-yellow-400">${event.title}</h3>
                    <p class="mb-4 text-sm">${event.description}</p>
                    <div id="event-choices" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${event.choices.map((choice, index) => `
                            <button class="choice-button w-full py-2 rounded" data-choice-index="${index}" data-type="event">${choice.text}</button>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.querySelectorAll('.choice-button[data-type="event"]').forEach(button => {
                button.addEventListener('click', (e) => handleWildcardDecision(e, event));
            });
        }

        function handleWildcardDecision(e, eventData) {
            const choiceIndex = e.target.dataset.choiceIndex;
            const choice = eventData.choices[choiceIndex];
            
            updateMetrics(choice.impact);

            const dilemmaBox = document.getElementById('dilemma-box');
            if(dilemmaBox) {
                dilemmaBox.innerHTML = `
                    <h3 class="title-font text-lg mb-2" id="dilemma-title"></h3>
                    <p class="mb-4 text-sm" id="dilemma-description"></p>
                    <div id="choices-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                `;
            }

            gameState.currentPhase++;
            if (gameState.currentPhase < gameState.phases.length) {
                setTimeout(() => renderPhase(gameState.currentPhase), 1500);
            } else {
                endGame();
            }
        }
        
        function endGame() {
            const finalMetrics = gameState.metrics;
            // FIX: Use gameData.endings which retains the functions, instead of gameState.endings
            let ending = gameData.endings.find(e => e.condition(finalMetrics));
            
            if (!ending) {
                // The default ending is the last one in the array
                ending = gameData.endings[gameData.endings.length - 1];
            }
            
            const endingTitleEl = document.getElementById('ending-title');
            const endingNarrativeEl = document.getElementById('ending-narrative');
            const endingModalEl = document.getElementById('ending-modal');

            if(endingTitleEl) endingTitleEl.textContent = ending.title;
            if(endingNarrativeEl) endingNarrativeEl.textContent = ending.narrative;
            if(endingModalEl) endingModalEl.classList.remove('hidden');
        }

        const restartButton = document.getElementById('restart-button');
        if(restartButton) {
            restartButton.addEventListener('click', () => {
                window.location.reload();
            });
        }

        renderMetrics();
        renderPhase(gameState.currentPhase);
    });
    </script>
</body>
</html>
